## （一）——简介

### 一、六轴机器人简介

六轴机器人中的六轴指个六自由度，由关节和连杆组成。常见的六轴机器人为**串联型旋转关节机器人**。

这种类型的机器人，无论在科学研究还是在生产制造中都十分常见。如图所示，有1~6共六个旋转关节。其中，关节1到3控制机械臂末端的位置，而关节4到6主要控制末端的姿态。通过在末端加上如卡盘，机械爪等执行件，机械臂便可完成各种各样的工作。

在控制层面，目前，应用在生产制造的机械臂大多采用示教控制，其过程简单，可以较方便地完成大部分工作。

### 二、六轴机器人主要研究内容

#### 1. 运动学分析

运动学分析主要研究机器人末端与基座的相对位置关系，是进行后续运动规划的理论基础。分为正运动学和逆运动学两部分。

##### 1.1 正运动学问题

常见的求解方法有D-H法和旋量理论法。D-H法通过在机器人上建立连杆坐标系，求得相邻关节的变换矩阵，最终获得机器人末端相对于基座的位姿关系。旋量理论法通过在全局坐标系下构建各关节的单位运动旋量，利用指数积公式求得机器人的正解。

##### 1.2 逆运动学问题

一般的求解方法有解析解法，数值解法和智能解法。

解析解法包括代数法，几何法和基于旋量理论的方法。

数值解法的核心思想是通过迭代解法求得逆解。

智能解法的代表有粒子群优化算法和神经网络算法等。

#### 2. 运动规划

##### 2.1 三个概念

在陈述这一部分之前，首先提一下这里经常会遇到的三个概念：运动规划，轨迹规划和路径规划。这三个概念也困扰了我好一段时间，这里讲一下我的认识。

- 路径规划：即规划一条从起始点到目标点的路径，不关乎其他。
- 轨迹规划：除了规划路径之外，还要给出具体经过每个路径点的时间，即得到包含路径点的时间序列。
- 运动规划：是个很广泛的概念，一般包括路径和轨迹规划，除上述两者之外，运动过程中运动体一切有关的动作和状态规划都可以称之为运动规划。

举个栗子，在你从家到学校的路上，有好多条路，选择哪一条路即为路径规划；在选择好哪一条路的同时，计划在第几分钟走到途中的公交站，超市等等，这就是轨迹规划；而以上这些，又都可以统称为运动规划，除此以外，在途中哪一段单脚跳着走，哪一段和朋友手拉手走，也是运动规划。

##### 2.2 路径规划

回归正题，对于机器人而言，一般的运动规划也分为轨迹规划和路径规划两部分。

路径规划一般指考虑避障的路径规划，常见的规划算法有两种，分别为基于图搜索和基于采样的算法。

基于图搜索的算法有Dijkstra算法和A算法等，后者是对前者的改进，由于加入了启发函数，使得A算法具有更好的性能。基于采样的算法有PRM（概率路图）和RRT（快速扩展随机树）算法。

##### 2.3 轨迹规划

轨迹规划是在一定的约束条件下，在起始位姿和终止位姿之间，规划出一系列随时间变化的位姿状态。可分为笛卡尔空间轨迹规划和关节空间轨迹规划。

笛卡尔空间规划是指根据起始点和终止点的位姿，直接求出末端的位姿变化函数。这种规划方法直观，对末端轨迹的控制精确，但计算量大。笛卡尔空间的规划可分为速度规划，位置规划和姿态规划三部分。

关节空间规划是指根据起始点。终止点和中间路径点的各关节的角度值，求出关节的角度变化函数，这种规划方法计算简单，控制方便。关节空间的规划可分为两点规划和多节点规划等。可采用多项式，多段S曲线以及B样条曲线规划等方法。
### 三、小结

以上对六轴机器人及其主要研究内容作了简单介绍，之后会就运动学分析，运动规划等问题具体进行介绍。

## （二）——运动学分析

本篇主要介绍六轴机械臂的运动学分析。

运动学分析是工业机器人研究和应用的重要内容，是运动控制的基础，主要研究机器人末端坐标系与基坐标系的转换关系，分为正运动学和逆运动学分析两部分。

另外，对于刚刚学习机器人理论的小伙伴，推荐看一下蔡自兴老师的《机器人学》这本书，里面对机器人介绍，运动学及动力学分析，以及运动规划等内容介绍的非常详细。

### 一、数理基础

在对机器人进行运动学分析时，一般将其各组成部分视为刚体，下面介绍运动学分析过程中用到的数理知识。

#### 1. 空间位姿描述

位姿表示刚体的位置和姿态。任何一个刚体在空间基坐标系B（OXYZ）中的位置状态都可以用位姿来准确描述。

位置描述：表示刚体上的点p在空间基坐标系中的位置，可用一个三维列向量来表示：

$$
\sideset{^{B}_{}}{^{}_{}}P = \begin{bmatrix}
p_{x} & p_{y} & p_{z}
\end{bmatrix}^{T}
$$

姿态描述：在刚体上建立坐标系E（O^’ X^’ Y’Z’）并与刚体固连，则刚体坐标系在与基坐标系同原点时，相对于基坐标系的转动即为刚体的姿态描述，可用一个3×3的姿态矩阵来表示：

$$
\sideset{^{B}_{E}}{^{}_{}}R = \begin{bmatrix}
n_{x} & o_{x} & a_{x} \\
n_{y} & o_{y} & a_{y} \\
n_{z} & o_{z} & a_{z} \\
\end{bmatrix}
$$

在机器人运动运动学分析中，在连杆末端建立坐标系。求得末端坐标系原点在基坐标系中的位置向量以及姿态矩阵后，连杆的位置状态便随之确定。

#### 2. 空间坐标变换

坐标系在机械系统的分析中起着至关重要的作用，系统中不同构件之间的关系都需要用坐标系来描述。在机器人系统中，常常需要定义各类坐标系，如基坐标系，末端坐标系及工具坐标系等。因此进行系统分析时，会涉及到用不同坐标系描述同一个连杆的问题，需要得到从一个坐标系描述到另一个坐标系描述的转换关系。这种转换关系包括平移，旋转，复合变换等。

##### 1）平移变换

若坐标系{E}和坐标系{B}的姿态相同但原点不重合，则P点在两个坐标系中的位置描述满足：

$$
\sideset{^{B}_{}}{^{}_{}}P = \sideset{^{E}_{}}{^{}_{}}P + \sideset{^{B}_{E}}{^{}_{}}P
$$

##### 2）旋转变换

若坐标系{E}和坐标系{B}的原点重合但姿态不相同，则P点在两个坐标系中的位置描述满足：

$$
\sideset{^{B}_{}}{^{}_{}}P = \sideset{^{B}_{E}}{^{}_{}}R\sideset{^{E}_{}}{^{}_{}}P
$$

##### 3）复合变换

若坐标系{E}和坐标系{B}的原点不重合且姿态不相同，则将前面两种变换结合在一起，P点的位置描述满足：

$$
\sideset{^{B}_{}}{^{}_{}} P = \sideset{^{B}_{E}}{^{}_{}} R \sideset{^{E}_{}}{^{}_{}} P + \sideset{^{B}_{E}}{^{}_{}} P
$$

#### 2. 齐次矩阵与齐次变换

在机器人学中，将位置向量和姿态矩阵结合起来，形成一个4×4的矩阵，称为齐次矩阵，来统一描述构件的位置和姿态，齐次矩阵表示为：

$$
\sideset{^{B}_{E}}{^{}_{}} T = \begin{bmatrix}
\sideset{^{B}_{E}}{^{}_{}} R &  \sideset{^{B}_{E}}{^{}_{}} P \\
0 & 1 \\
\end{bmatrix}
$$

齐次矩阵不但可以描述构件在空间中的位姿，还可以描述不同坐标系的位姿变换过程。在描述点的坐标时，通过在三维坐标中加入比例因子1，将其变为齐次坐标：

$$
P' = \begin{bmatrix}
p_{x} & p_{y} & p_{z} & 1
\end{bmatrix}^{T} = \begin{bmatrix}
P & 1
\end{bmatrix}^{T}
$$

用P点的齐次坐标左乘齐次变换矩阵，得到其在不同坐标系下的位置描述，这种变换称为齐次变换，变换过程可以表示为：

$$
\sideset{^{B}_{}}{^{}_{}} P' = \sideset{^{B}_{E}}{^{}_{}} T \sideset{^{E}_{}}{^{}_{}} P' = \begin{bmatrix}
\sideset{^{B}_{E}}{^{}_{}} R  & \sideset{^{B}_{E}}{^{}_{}} P \\
0  & 1
\end{bmatrix} \begin{bmatrix}
\sideset{^{E}_{}}{^{}_{}} P \\
1
\end{bmatrix}
$$

拥有以上数理基础后，可以进行运动学建模及分析。

### 二、运动学建模

对于多关节串联型的工业机器人，一般采用D-H法建模。D-H 法是 Denavit和Hartenberg在1955年提出的，通过在机器人所有连杆上建立固连坐标系，用齐次变换矩阵描述相邻连杆的关系。下图为D-H法的通用连杆-关节示意图。

![[v2-107ef4b213ba3448b31f46204b37e06e_1440w.webp]]

D-H法分为标准D-H法和改进D-H法两种，两者在连杆参数定义及变换顺序上略有不同。两种方法均定义了四个参数，包括关节转角θ，关节偏距d，连杆扭角α以及连杆长度a。两种建模方法的不同如下表所示：

|             | D-H 法                  | 改进 D-H 法                                        |
| ----------- | ---------------------- | ----------------------------------------------- |
| 固连坐标系       | 以连杆后一个关节坐标系为其固连坐标系     | 以连杆前一个关节坐标系为其固连坐标系                              |
| 相邻关节坐标系变换顺序 | $\theta, d, a, \alpha$ | $a, \alpha, d, \theta$ 或 $\alpha, a, \theta, d$ |

#### 1. 建立连杆坐标系

D-H法建模的第一步，需要根据机器人确定连杆坐标系。其中，各个坐标系的Z轴方向与关节旋转方向相同，X轴与Y轴的确定可具体查阅资料，D-H法和改进D-H法确定X轴的方式也是不同的。建好的坐标系如下图：

![[D-H 坐标系示例图.png]]

#### 2. 确定连杆参数

这里以改进D-H法为例，介绍四个参数的确定方法。

连杆i-1坐标系经过2次旋转和2次平移可以变换到连杆i的坐标系。这4次变换分别为:

(1) 沿Xi-1轴平移ai-1, 将Oi-1移动到O′i-1;

(2) 以Xi-1为转轴, 旋转αi-1角度, 使新的Zi-1轴与Zi轴同向;

(3) 沿Zi平移di, 使O′i-1移动到Oi;

(4) 以Zi轴为转轴, 旋转θi角度, 使新的Xi-1轴与Xi轴同向。

通过四次变换，便可得到各连杆参数表。对应上图的连杆参数表如下：

| 序号  | 连杆长度 $a_{i - 1}$ | 连杆扭角 $\alpha_{i - 1}$ | 关节偏距 $d_{i}$ | 关节转角 $\theta_{i}$ |
| --- | ---------------- | --------------------- | ------------ | ----------------- |
| 1   | 0                | 0                     | 430          | -180~180          |
| 2   | 100              | 90                    | 0            | -55~195           |
| 3   | 650              | 0                     | 0            | -73~240           |
| 4   | 0                | 90                    | 700          | -270~270          |
| 5   | 0                | -90                   | 0            | -145~145          |
| 6   | 0                | -90                   | 0            | -360~360          |
| 7   | 0                | 0                     | 88           | 0                 |

### 三、运动学分析

求解机器人各连杆关节的运动关系称为机器人运动学。已知各连杆夹角以及其余连杆坐标系参数，求解末端执行器的位姿，称为机器人的正运动学求解，反之称为逆运动学求解。

#### 1. 正运动学求解

相邻坐标系的转换关系可以由其变换矩阵表示。 根据前述，连杆i-1坐标系经过2次旋转和2次平移可以变换到连杆i的坐标系，将这四次变换分别用矩阵表示出来，然后相乘就可以得到相邻关节的变换矩阵。

对于改进D-H法而言，变换矩阵可以表示为：

$$
\begin{align}
\sideset{^{i - 1}_{i}}{^{}_{i}} T &  = Trans_{x}(a_{i - 1})Rot_{x}(\alpha_{i - 1})Trans_{z}(d_{i})Rot_{z}(\theta_{i})  \\
 & = \begin{bmatrix}
 \cos\theta_{i} & -\sin\theta_{i} & 0 & a_{i - 1} \\
\cos\alpha_{i - 1}\sin\theta_{i}  & \cos\alpha_{i - 1}\cos\theta_{i} & -\sin\alpha_{i - 1} & -d_{i}\sin\alpha_{i - 1} \\
\sin\alpha_{i - 1}\sin\theta_{i} & \sin\alpha_{i - 1}\cos\theta_{i} & \cos\alpha_{i - 1} & d_{i}\cos\alpha_{i - 1} \\
0  & 0  & 0  & 1
\end{bmatrix}
\end{align}
$$

将各个连杆参数代入，便可得到形如下式的变换矩阵：

$$
\sideset{^{0}_{}}{^{}_{1}} T = \begin{bmatrix}
c_{1} &  -s_{1} & 0 & 0 \\
s_{1} & c_{1} & 0 & 0 \\
0 & 0 & 1 & d_{1} \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

最后，将各个关节的变换矩阵相乘，便得到总的变换矩阵：

$$
\sideset{^{0}_{}}{^{}_{6}} T = \sideset{^{0}_{}}{^{}_{1}} T \sideset{^{1}_{}}{^{}_{2}} T\sideset{^{2}_{}}{^{}_{3}} T\sideset{^{3}_{}}{^{}_{4}} T\sideset{^{4}_{}}{^{}_{5}} T \sideset{^{5}_{}}{^{}_{6}} T = \begin{bmatrix}
n_{x} & o_{x} & a_{x} & p_{x} \\
n_{y} & o_{y} & a_{y} & p_{y} \\
n_{z} & o_{z} & a_{z} & p_{z}  \\
0 & 0 & 0 & 1
\end{bmatrix}
$$

至此我们得到了机器人的正运动学方程，即求得了运动学的正解。

#### 2. 逆运动学求解

求取机器人的逆解，就是在已知末端执行器位姿的情况下，经过矩阵变换，求得各个关节的转角，从而控制机器人达到理想的位姿。

求逆解的一般方法为：在如上图所示的矩阵方程两端，同时乘单个T矩阵的逆矩阵，接着进行观察，令等号两端矩阵特定元素对应相等，得到方程进行求解。

按照我所求的逆解举例，首先在正运动学求解过程中，得到了矩阵 $\sideset{^{0}_{}}{^{}_{6}} T = \sideset{^{0}_{}}{^{}_{1}} T \sideset{^{1}_{}}{^{}_{2}} T\sideset{^{2}_{}}{^{}_{3}} T\sideset{^{3}_{}}{^{}_{4}} T\sideset{^{4}_{}}{^{}_{5}} T \sideset{^{5}_{}}{^{}_{6}} T$ 的具体形式。在求逆解时，矩阵  $\begin{bmatrix} n_{x} & o_{x} & a_{x} & p_{x} \\ n_{y} & o_{y} & a_{y} & p_{y} \\ n_{z} & o_{z} & a_{z} & p_{z}  \\ 0 & 0 & 0 & 1 \end{bmatrix}$ 的元素是已知的，因此通过观察，令等式两端矩阵中的（1,4），（2,4），（3,4）元素对应相等，可以得到方程：

$$
\begin{cases}
p_{x} = d_{4}c_{1}s_{23} + a_{1}c_{1} + a_{2}c_{1}c_{2} \\
p_{y} = d_{4}s_{1}s_{23} + a_{1}s_{1} + a_{2}s_{1}c_{2} \\
p_{z} = d_{1} - d_{4}c_{23} + a_{2}s_{2} \\
\end{cases}
$$

进而得到前三个关节角的解析解：

$$
\begin{cases}
\theta_{1} = a\tan 2\left( \frac{p_{y}}{p_{x}} \right) \\
\theta_{2} = \arcsin\left( \frac{p_{z} - d_{1}}{\sqrt{ d_{4}^{2}c_{3}^{2} + (d_{4}s_{3} + a_{2})^{2} }} \right) + \arctan\left( \frac{d_{4}c_{3}}{d_{4}s_{3}+{a_{2}}} \right) \\
\theta_{3} = \left( \frac{(p_{x} - a_{1}c_{1})^{2} + (p_{y} - a_{1}s_{1})^{2} + (p_{z} - d_{1})^{2} - (a_{2}^{2} + d_{4}^{2})}{2a_{2}d_{4}} \right) 
\end{cases}
$$

2.1 求逆解时的注意点：

（1）由于反三角函数的性质，一个三角函数值对应两个角度，因此求出的逆解往往有多组。常见情况下，对六自由度机械臂而言，求出的逆解有八组。

（2）求逆解过程中计算复杂（涉及大量矩阵运算和解三角函数方程），且没有统一的计算方法，所以刚开始求解时，一定要沉下心来，并且多加练习，就可以掌握规律，求得正确结果。

### 四、总结

本篇主要介绍了六轴机械臂的运动学建模以及正逆运动学求解过程，为后续运动规划奠定基础。

## （三）——机器人建模及运动学分析的Matlab仿真

在完成机器人的建模以及运动学分析之后，可以利用Matlab中的Robotics工具箱进行仿真。

### 一、工具箱下载

要在Matlab里进行机器人相关的仿真，首先需要下载Matlab Robotics工具箱，具体的下载及安装方法网上有很多。

### 二、机器人建模仿真

这是利用Matlab进行建模的代码：

```text
clear;
close all;
clc;
huan=10^-3;
H=pi/180;
theta1 = 0;   D1 = 430*10^-3;   A1 = 0    ; alpha1 = 0;    offset1 = 0;
theta2 = 0;   D2 = 0;     A2 = 100*10^-3;  alpha2 = pi/2;    offset2 = 0;
theta3 = 0;   D3 = 0;     A3 = 650*10^-3; alpha3 = 0; offset3 = 0;
theta4 = 0;   D4 = 700*10^-3;   A4 = 0;     alpha4 = pi/2; offset4 = 0;
theta5 = 0;   D5 = 0;     A5 = 0;     alpha5 = -pi/2; offset5 = 0;
theta6 = 0;   D6 = 0;     A6 = 0;     alpha6 = pi/2;    offset6 = 0;
L(1) = Link([theta1, D1, A1, alpha1, offset1], 'modified');
L(2) = Link([theta2, D2, A2, alpha2, offset2], 'modified');
L(3) = Link([theta3, D3, A3, alpha3, offset3], 'modified');
L(4) = Link([theta4, D4, A4, alpha4, offset4], 'modified');
L(5) = Link([theta5, D5, A5, alpha5, offset5], 'modified');
L(6) = Link([theta6, D6, A6, alpha6, offset6], 'modified');

robot0 = SerialLink(L,'name','kwa');
Theta=[pi,0.523598775598299,-0.109781209950443,0,0.413817565647856,0];

figure(1);
robot0.plot(Theta);
robot0.teach;
```

对于代码，有几个注意的点：

（1）Link函数里的六个变量：前四个表示每个连杆的四个连杆参数；第五个代表关节形式。0代表旋转关节；最后的’modified’代表采用改进D-H法建模，如果用标准D-H法的话，可不写这一项。

（2）robot0.plot为展示给定关节角下机器人运动状态的命令；;robot0.teach;为展示示教界面的命令。

![[Matlab 仿真界面.png]]

加入示教命令后，界面如下：

![[Matlab 示教命令.png]]

其中，左下角为示教器，可调节各个关节角度，左上角为机械臂末端的位姿，包括末端位置及表示姿态的RPY角。

### 三、机器人运动学计算仿真

在Matlab里，有两个函数，可以进行机器人正逆运动学的计算，即fkine与ikine函数，前者为正运动学，后者为逆运动学。使用格式为：

```text
T=robot0.fkine(Theta);
theta=robot0.ikine(T);
```

其中，第一个theta为给定的关节角向量，得到的T转换矩阵，不过以SE3的结构体形式存储。

要处理这个类型的变量，可以使用如下命令：

```text
TT=T.T
```

得到的TT矩阵便为四乘四的矩阵。  
**这里要注意的是**：  
ikine函数仅可以得到一组逆解，如果想要完整求出所有逆解，还是要自己求出解析解的表达式，然后编程计算。

### 四、小结

本篇介绍了使用Matlab进行机器人建模及正逆运动学计算的仿真过程，提供了部分Matlab代码。

## （四）——轨迹规划

### 一、轨迹规划概述

对机器人进行轨迹规划的主要任务是，根据机器人的工作环境和工作任务要求，求得一系列机器人末端位姿变换的时间序列，使得机器人末端可以正确地从初始姿态沿着期望的轨迹运动到终止位姿，完成工作任务，。对于六自由度的机器人来说，轨迹规划要解决的关键问题是将末端位姿的变换转变为六个关节变量的变换，这也是其与移动机器人轨迹规划的不同之处。

进行轨迹规划的方法有两种：一种是在关节空间进行规划，另一种是在笛卡尔空间，即直角坐标空间进行规划。

（1）关节空间规划是通过确定各个关节转角变化序列，从而规划机械臂末端的空间运动轨迹。其优点是只用对六个关节变量分别进行规划，计算简单，但不能精确地控制机械臂末端的位姿变化。

（2）笛卡尔空间规划就是对机械臂末端的位姿变化直接进行规划，在得到机械臂末端在某一时刻的位姿后，利用逆运动学方程直接求出此刻各个关节转角变量的值。其优点是机械臂末端的轨迹易于观察，可以更精确控制地控制末端轨迹，同时避免末端执行器与空间障碍物发生碰撞。但缺点是需要进行大量的逆运动学计算，并且需要选取大量的中间插值点以得到精确的末端轨迹，控制过程复杂。

### 二、关节空间规划

机器人关节空间规划一般分为点对点规划和多节点规划。

#### 1. 点对点规划

当给定起始点和终止点的约束条件，需要求出连接两点的轨迹时，这样的问题称为点对点轨迹规划。常用的点对点轨迹规划方法有三次多项式规划，五次多项式规划等。这里采用五次多项式进行规划，其一般形式为：

$$
\theta(t) = a_{0} + a_{1}(t - t_{s}) + a_{2}(t - t_{s})^{2} + a_{3}(t - t_{s})^{3} + a_{4}(t - t_{s})^{4} + a_{5}(t - t_{s})^{5}
$$

六个未知数需要给定六个约束条件，分别为起点和终点的角位移，角速度和角加速度。约束条件的方程为：

$$
\begin{cases}
\theta(t_{s}) = \theta_{s} \\
\theta(t_{e}) = \theta_{e} \\
\dot{\theta}(t_{s}) = \omega_{s} \\
\dot{\theta}(t_{e}) = \omega_{e} \\
\ddot{\theta}(t_{s}) = \alpha_{s} \\
\ddot{\theta}(t_{e}) = \alpha_{e} \\
\end{cases}
$$

求解方程组，得到六个未知数，其中 $T = t_{e} - t_{s}$：

$$
\begin{cases}
a_{0} =  \theta_{s} \\
a_{1} = v_{s} \\
a_{2} = 0.5 \alpha_{s} \\
a_{3} = \frac{1}{2T^{3}}[20(\theta_{e} - \theta_{s}) - (8v_{e} + 12v_{s})T + (\alpha_{e} - 3\alpha_{s})T^{2}] \\
\alpha_{s} = \frac{1}{2T^{4}}[-30(\theta_{e} - \theta_{s}) + (14v_{e} + 16v_{s})T - (2\alpha_{e} - 3\alpha_{s})T^{2}] \\
\alpha_{e} = \frac{1}{2T^{5}}[12(\theta_{e} - \theta_{s}) - (6v_{e} + 6v_{s})T + (\alpha_{e - \alpha_{s}})T^{2}]
\end{cases}
$$

将参数代入到五次多项式中，得到所求轨迹。

#### 2. 多节点规划

当给定除起点和终点外，若干个中间点的约束条件，需要求出经过所有点的轨迹时，这样的问题称为多节点轨迹规划。进行多节点规划时，可以将多节点分段，每段有两个节点，对每段分别进行点对点规划。即多节点规划可以看作多段点对点规划的组合。

为了保证机器人平稳运行，在多节点规划时，一种有效的方法是使中间连接点处的角位移，角速度和角加速度相同。在这种情况下依然可以采用五次多项式规划。只需要给出每个节点处的角位移，角速度和角加速度条件，按照上一节中的方法，求出每段轨迹的六个参数，代入轨迹方程中，即可得到所求轨迹。

**示例程序**

这里对六个关节角进行多节点规划，一共给定四个节点的角度，角速度和角加速度条件，其中一段的规划程序如下：

```matlab
for i=1:3  %每一段规划的时间
     T=t_array(i+1)-t_array(i);
     a10=q1_array(i);
     a11=v_array(i);
     a21=a_array(i)/2;
     a31=(20*q1_array(i+1)-20*q1_array(i)-(8*v_array(i+1)+12*v_array(i))*T-(3*a_array(i)-a_array(i+1))*T^2)/(2*T^3);
     a41=(30*q1_array(i)-30*q1_array(i+1)+(14*v_array(i+1)+16*v_array(i))*T+(3*a_array(i)-2*a_array(i+1))*T^2)/(2*T^4);
     a51=(12*q1_array(i+1)-12*q1_array(i)-(6*v_array(i+1)+6*v_array(i))*T-(a_array(i)-a_array(i+1))*T^2)/(2*T^5);%计算五次多项式系数 
     ti=t_array(i):0.01:t_array(i+1);
     qi=a10+a11*(ti-t_array(i))+a21*(ti-t_array(i)).^2+a31*(ti-t_array(i)).^3+a41*(ti-t_array(i)).^4+a51*(ti-t_array(i)).^5;
     vi=a11+2*a21*(ti-t_array(i))+3*a31*(ti-t_array(i)).^2+4*a41*(ti-t_array(i)).^3+5*a51*(ti-t_array(i)).^4;
     ai=2*a21+6*a31*(ti-t_array(i))+12*a41*(ti-t_array(i)).^2+20*a51*(ti-t_array(i)).^3;
     t=[t,ti(2:end)];q=[q,qi(2:end)];v1=[v1,vi(2:end)];a1=[a1,ai(2:end)];
end
```

角度规划结果如图所示：

![[Matlab 角度规划.png]]

### 三、笛卡尔空间规划

在进行机器人笛卡尔空间轨迹规划时，一般的方法为：

（1）根据机械臂末端起点和终点的轨迹，确定一条从起点到终点的路径。

（2）确定插补点的个数，进而确定路径上的若干中间点。

（3）由一系列的机械臂末端坐标进行逆运动学计算，求解出六个关节转角的变化情况。

这种方法称为数值解法。

主要涉及到三个方面的规划：

#### 1. 速度规划

由力学原理可知，机器人在运动过程中如果出现加速度突变的情况，会产生机械冲击，导致机器人关节磨损。因此在进行轨迹规划时，首先需要对各关节进行速度规划，保证运行过程中加速度连续变化。

S曲线是适用于此种情况的速度曲线，整段曲线由抛物线和直线段组成，对应的加速度曲线连续。S曲线一般有三段，五段和七段S曲线三种，七段S曲线包括七个阶段，其在满足加速度连续的基础上，还有两端加速度恒定的过程，运动更加平稳。七段S曲线的计算方法采用分类讨论法，示意曲线为：

![[轨迹规划速度规划.png]]

除了S曲线外，也可以使用多项式曲线等等。

#### 2. 位置规划

位置规划指对机械臂末端的轨迹进行规划，一般采用直线插补和圆弧插补以及这两种的组合进行规划。

（1）直线插补

目的是使机械臂末端的轨迹为一段直线，具体步骤非常简单：只需将起点与终点直线连接，然后根据所需的精度确定插补点的个数，最后确定每一个插补点的坐标即可。

（2）圆弧插补

由于空间中的圆弧轨迹插补比较复杂，因此可以采用这样的步骤：

1）首先根据起点终点与圆心确定一个新的平面；

2）接着以建立的平面为基准，建立一个新的坐标系；

3）确定新坐标系与末端坐标系之间的转换关系；

4）在新坐标系里完成平面圆弧插补，确定每个插补点的坐标；

5）根据坐标转化关系，得到末端坐标下的三维插补点坐标。

#### 3. 姿态插补

在机器人运行过程中，有些场景的末端姿态不发生变化，如打磨等，但在执行较复杂的工作时，末端姿态在运动过程中也会变化，如复杂的焊接过程等等。姿态规划的任务时，根据机械臂末端起始点和终止点的姿态，规划出合理的姿态变化过程，以满足特定的约束条件（如避障，工作任务约束等）。

规划时，一种方法是采用四元数进行规划，具体方法我当时没有具体研究，有需要的小伙伴可以自行探索。

#### 4. 基于几何解法的一种简化位置规划方法

前文介绍的位置插补规划方法原理简单，但缺点是需要进行大量的逆运动学计算。这里根据机器人运动过程的特殊性，提出了一种几何求解法，对问题求解进行了简化。

（1）首先讨论平面内的竖直运动过程：

![[平面竖直运动过程.png]]

由正运动学分析可知，关节转角θ1只与机械臂末端的横纵坐标有关，因此在竖直运动过程中θ1保持不变。另外，在运动过程中，末端的姿态保持不变，由机器人关节的结构可知，关节转角θ4与θ6为定值。经过以上分析，竖直方向的运动只需研究剩下的三个关节转角的变化，这三个转角的相对关系如上图所示。

图中定义了两个角度 $\alpha_{1}, \alpha_{2}$ 及一个长度 $l$，当起始点和终止点给定时，$l$ 为定值。他们与关节转角 $\theta_{2}, \theta_{3}, \theta_{5}$ 的关系如下式所示：

$$
\begin{cases}
\theta_{2} = \alpha_{1} \\
\theta_{3} = \frac{\pi}{2} - \theta_{2} - \alpha_{2} \\
\theta_{5} = \frac{\pi}{2} - \alpha_{2}
\end{cases}
$$

$$
l_{2}\cos\alpha_{1} + l_{3}\cos\alpha_{2} = l
$$

得到以上关系后，进行规划时，只需对起点和终点的末端坐标进行两次逆运动学计算，得到其中一个关节角的起点和终点坐标，接着对其进行插补，得到中间插补点的角度，最后根据关节角之间的关系，得到其他关节角的一系列角度。

最后得到的杆件仿真图如下：

![[Matlab 竖向运动仿真图.png]]

2）平面内的水平直线运动

![[水平直线运动过程.png]]

图中定义了一个高度差 $\Delta h$，当轨迹起始点和终止点给定，式中 $\Delta h$ 为定值。同样的，运动过程中，关节角的关系为：

$$
\begin{cases}
\theta_{2} = \alpha_{1} \\
\theta_{3} = \frac{\pi}{2} - \theta_{2} - \alpha_{2} \\
\theta_{5} = \frac{\pi}{2} - \alpha_{2}
\end{cases}
$$

$$
l_{2}\sin\alpha_{1} - l_{3}\sin\alpha_{2} = \Delta h
$$

通过计算得到的杆件仿真图如下：

![[Matlab 水平运动仿真图.png]]

将这两种运动与关节1的运动组合，就可以形成不同的末端轨迹，以实现简单运动情况下的位置规划。

#### 5. 两种规划的Matlab程序

Matlab提供了jtraj和ctraj两种函数，分别用于笛卡尔空间以及关节空间的轨迹规划。两者的使用格式分别为：  
（1）关节空间规划

```matlab
[q ,qd, qdd]=jtraj(q1,q2,50)
```

给定q1，q2分别为起始点和终止点的关节角，50为插补点个数。得到的q，qd，qdd，分别为关节角度，角速度以及角加速度系列。

（2）笛卡尔空间规划

```matlab
Tc=ctraj(p1,p2,step)
```

给定p1，p2为起始点和终止点的四乘四位姿矩阵，step为插补点个数，得到的Tc为一系列中间姿态矩阵。

这里利用两个函数，进行一个简单的规划示例：

```matlab
clear;
clc;
%建立机器人模型
L1=Link([0       0.4      0.025    pi/2      0     ]); 
L2=Link([pi/2    0        0.56     0         0     ]);
L3=Link([0       0        0.035    pi/2      0     ]);
L4=Link([0       0.515    0        pi/2      0     ]);
L5=Link([pi      0        0        pi/2      0     ]);
L6=Link([0       0.08     0        0         0     ]);
robot=SerialLink([L1 L2 L3 L4 L5 L6],'name','kaw');
T1=transl(0.5,0,0);%起始点位姿
T2=transl(0,-0.5,0);%终止点位姿
q1=robot.ikine(T1);%起始点关节角
q2=robot.ikine(T2);%终止点关节角

%关节空间顾规划
[q ,qd, qdd]=jtraj(q1,q2,50); 
T=robot.fkine(q);%根据插值，得到末端执行器位姿
figure(1)
robot.plot(q);%动画演示

%笛卡尔空间顾规划
Tc=ctraj(T1,T2,20);
for i=1:20
    qc(i,:)=robot.ikine(Tc(:,:,i));
end
figure(2)
robot.plot(qc);
```

### 四、小结

本篇介绍了六轴机器人关节空间以及笛卡尔空间轨迹规划的简单方法，并给出了一种几何解法，以简化规划过程，并提供了简单的Matlab轨迹规划函数介绍。



后续资料：
- [六自由度机器人（机械臂）运动学建模及运动规划系列（四）——轨迹规划 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/550310365)
- [六自由度机器人（机械臂）运动学建模及运动规划系列（五）——避障路径规划 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/550303214)
- [六自由度机器人（机械臂）运动学建模及运动规划系列（六）——避障路径规划算法补充：蚁群算法 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/559598013)